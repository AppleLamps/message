# AI Chat Messenger

An iMessage-style chat UI backed by an Express + Postgres API. Messages are persisted with Drizzle ORM and every user message is answered by OpenAI (streamed via the server). Built with Vite + React, TanStack Query, and a small typed API surface.

## Features
- Conversational UI that mirrors iMessage bubbles, read receipts, and typing indicator.
- Persists chat history in Postgres via Drizzle ORM.
- OpenAI-powered assistant replies using the full conversation history.
- Single Express server serves both API and bundled client (Vite) in production.
- Strict TypeScript types shared between client and server.

## Stack
- Frontend: React 19, Vite, TanStack Query, Wouter, Tailwind utilities.
- Backend: Express, OpenAI SDK, Drizzle ORM (Postgres), esbuild bundling.
- Auth/storage: Express sessions are provisioned, Postgres via `DATABASE_URL`.

## Prerequisites
- Node.js 20+
- Postgres database (connection string in `DATABASE_URL`)
- OpenAI-compatible endpoint and key for replies

## Quickstart (Development)
1) Install deps
```bash
npm install
```
2) Configure environment (.env)
```bash
DATABASE_URL=postgres://user:password@localhost:5432/dbname
AI_INTEGRATIONS_OPENAI_API_KEY=sk-...
# Optional, if using a non-default endpoint
AI_INTEGRATIONS_OPENAI_BASE_URL=https://api.openai.com/v1
```
3) Create tables (Drizzle)
```bash
npm run db:push
```
4) Run dev server (API + Vite middleware on port 5000)
```bash
npm run dev
```
The app is available at http://localhost:5000. API routes are under `/api`.

### Frontend-only dev
```bash
npm run dev:client  # Vite dev server on port 5000
```

## Build & Production
```bash
npm run build   # builds client (dist/public) and bundles server (dist/index.cjs)
npm start       # serves API and static client from dist on PORT (default 5000)
```

## API
- `GET /api/messages` — fetch all messages (ordered oldest → newest)
- `POST /api/messages` — body: `{ content: string, isUser: true }`; saves user message, calls OpenAI, persists assistant reply, returns both
- `DELETE /api/messages` — clears all stored messages

## Database Schema (Drizzle)
- `users`: `id`, `username`, `password`
- `messages`: `id`, `content`, `isUser`, `timestamp`
Tables live in `shared/schema.ts`; migrations are generated by Drizzle (`npm run db:push`).

## Project Structure
- `server/` — Express setup, routes, static serving, Vite dev middleware
- `client/` — React app (pages, components, hooks, styling)
- `shared/` — Drizzle models and Zod schemas shared across client/server
- `script/build.ts` — builds client then bundles server with esbuild

## Environment Variables
- `DATABASE_URL` (required): Postgres connection string.
- `AI_INTEGRATIONS_OPENAI_API_KEY` (required): key for OpenAI requests.
- `AI_INTEGRATIONS_OPENAI_BASE_URL` (optional): override the OpenAI base URL.
- `PORT` (optional, default `5000`): server/listen port.

## Troubleshooting
- “Could not find the build directory”: run `npm run build` before `npm start`.
- OpenAI errors: verify API key/base URL, and that the model (`gpt-4o-mini`) is available to your account or proxy.


